<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common :: commonHead('创建采购订单')}"></head>
<body>

<div class="container-fluid">
    <div class="row">
        <nav th:replace="~{common :: sidebar('inbound')}"></nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

            <div th:replace="~{common :: topbar}"></div>

            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                <h1 class="h4">创建采购订单</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">首页</a></li>
                        <li class="breadcrumb-item"><a href="#">采购</a></li>
                        <li class="breadcrumb-item active">创建采购订单</li>
                    </ol>
                </nav>
            </div>

            <form id="createOrderForm">
                <div class="card card-erp">
                    <div class="card-header">采购订单基本信息</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-danger">* 供应商</label>
                                <select class="form-select" name="supplier">
                                    <option selected disabled>搜索并选择供应商</option>
                                    <option>可口可乐饮料有限公司</option>
                                    <option>顶新国际集团</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">预期交货日期</label>
                                <input type="date" class="form-control" name="deliveryDate" value="2025-12-16">
                            </div>
                            <div class="col-12">
                                <label class="form-label">备注</label>
                                <textarea class="form-control" rows="3" placeholder="请输入订单备注"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card card-erp">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>商品明细 <span class="text-danger">*</span></span>
                        <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#productSelectModal">
                            + 添加商品
                        </button>
                    </div>
                    <div class="card-body text-center py-5" id="emptyState">
                        <i class="bi bi-box-seam" style="font-size: 3rem; color: #dee2e6;"></i>
                        <p class="text-muted mt-3">暂无商品明细，请点击右上角添加</p>
                    </div>

                    <div class="card-body d-none" id="productTableWrap">
                        <table class="table table-bordered">
                            <thead class="table-light">
                            <tr>
                                <th>商品名称</th>
                                <th>数量</th>
                                <th>单价</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody id="productTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="fixed-bottom bg-white border-top p-3" style="left: 240px; text-align: right;">
                    <button type="button" class="btn btn-light me-2">取消</button>
                    <button type="button" class="btn btn-outline-secondary me-2">保存草稿</button>
                    <button type="button" class="btn btn-primary" onclick="submitOrder()">提交订单</button>
                </div>
            </form>

        </main>
    </div>
</div>

<div class="modal fade" id="productSelectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">选择商品</h5>
            </div>
            <div class="modal-body">
                <select class="form-select" id="modalProductSelect">
                    <option th:each="p : ${products}" th:value="${p.id}" th:text="${p.name}" th:data-price="${p.costPrice}"></option>
                </select>
                <div class="mt-3">
                    <label>数量</label>
                    <input type="number" class="form-control" id="modalQuantity" value="1">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="addProductRow()">确定添加</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
    function addProductRow() {
        var select = $("#modalProductSelect option:selected");
        var id = select.val();
        var name = select.text();
        var price = select.data("price");
        var qty = $("#modalQuantity").val();

        $("#emptyState").addClass("d-none");
        $("#productTableWrap").removeClass("d-none");

        var row = `<tr>
            <td>${name} <input type="hidden" name="productId" value="${id}"></td>
            <td>${qty} <input type="hidden" name="quantity" value="${qty}"></td>
            <td>${price} <input type="hidden" name="purchasePrice" value="${price}"></td>
            <td><button type="button" class="btn btn-sm btn-link text-danger" onclick="$(this).closest('tr').remove()">删除</button></td>
        </tr>`;

        $("#productTableBody").append(row);
        $("#productSelectModal").modal("hide");
    }

    function submitOrder() {
        alert("样式演示：提交订单逻辑需配合后端接口");
    }
</script>

</body>
</html>