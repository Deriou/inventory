<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common :: commonHead('新增用户')}"></head>
<body>

<div>
    <nav th:replace="~{common :: sidebar('system', 'user_add')}"></nav>

    <main>
        <div th:replace="~{common :: topbar}"></div>

        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-4 border-bottom pb-3">
            <div>
                <h1 class="h4 mb-1">新增用户</h1>
                <span class="text-muted small">创建新账号并设置初始权限</span>
            </div>
            <a href="/page/system/user/list" class="btn btn-secondary btn-sm">
                返回列表
            </a>
        </div>

        <div class="card card-erp" style="max-width: 700px;">
            <div class="card-header bg-white py-3">
                <h6 class="m-0 fw-bold text-dark">基本信息</h6>
            </div>
            <div class="card-body p-4">
                <form id="addUserForm">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label fw-bold">用户名 <span class="text-danger">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" name="username" placeholder="登录账号" required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label fw-bold">真实姓名</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" name="realName" placeholder="员工姓名">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label fw-bold">初始密码 <span class="text-danger">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" name="password" required>
                        </div>
                    </div>

                    <div class="mb-4 row">
                        <label class="col-sm-3 col-form-label fw-bold">角色权限 <span class="text-danger">*</span></label>
                        <div class="col-sm-9">
                            <select class="form-select" name="role">
                                <option value="3" selected>财务 / 普通员工</option>
                                <option value="2">库管员 (出入库权限)</option>
                                <option value="1">管理员 (系统全权)</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-9 offset-sm-3">
                            <button type="button" onclick="submitUser()" class="btn btn-primary px-4">保存用户</button>
                            <button type="reset" class="btn btn-light border ms-2">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>

<div th:replace="~{common :: commonScripts}"></div>

<script>
    function submitUser() {
        var formData = {};
        $("#addUserForm").serializeArray().forEach(item => formData[item.name] = item.value);

        if (!formData.username || !formData.password) {
            alert("用户名和密码不能为空！");
            return;
        }

        $.ajax({
            url: "/sysUser/add",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function(res) {
                if(res.success) {
                    alert("用户创建成功！");
                    location.href = "/page/system/user/list"; // 跳转回列表
                } else {
                    alert("创建失败: " + res.msg);
                }
            },
            error: function() {
                alert("系统错误，请联系管理员");
            }
        });
    }
</script>

</body>
</html>