<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common :: commonHead('采购入库')}"></head>
<body>

<div>
  <nav th:replace="~{common :: sidebar('inbound', 'inbound_receive')}"></nav>

  <main>
    <div th:replace="~{common :: topbar}"></div>

    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-4 border-bottom pb-3">
      <div>
        <h1 class="h4 mb-1">采购入库</h1>
        <span class="text-muted small">确认收货并增加商品库存</span>
      </div>
    </div>

    <div class="alert alert-primary d-flex align-items-center mb-4 shadow-sm border-0" role="alert">
      <i class="bi bi-info-circle-fill me-2 fs-5"></i>
      <div>
        此处仅显示状态为 <strong>【待入库】</strong> 的订单。请核对实物数量无误后，点击右侧按钮完成入库。
      </div>
    </div>

    <div class="card card-erp">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="bg-light text-muted">
            <tr>
              <th class="ps-4" style="width: 120px;">单据编号</th>
              <th>商品名称</th>
              <th>采购数量</th>
              <th>下单时间</th>
              <th class="text-end pe-4">操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="i : ${inbounds}">
              <td class="ps-4">
                <span class="font-monospace text-primary fw-bold" th:text="|PO-${i.id}|"></span>
              </td>
              <td>
                <div class="fw-bold text-dark" th:text="${i.productName}"></div>
              </td>

              <td>
                                    <span class="badge bg-warning text-dark rounded-pill px-3">
                                        + <span th:text="${i.quantity}"></span>
                                    </span>
              </td>

              <td class="text-muted small" th:text="${#temporals.format(i.createTime, 'MM-dd HH:mm')}"></td>

              <td class="text-end pe-4">
                <button class="btn btn-sm btn-success shadow-sm"
                        th:onclick="'confirmInbound(' + ${i.id} + ')'"
                        title="确认货物已到">
                  <i class="bi bi-box-seam me-1"></i> 确认收货
                </button>
              </td>
            </tr>

            <tr th:if="${#lists.isEmpty(inbounds)}">
              <td colspan="5" class="text-center py-5 text-muted">
                <div class="mb-2">
                  <i class="bi bi-clipboard-check fs-1 text-gray-300"></i>
                </div>
                <div>当前没有待处理的入库单</div>
                <a href="/page/inbound/create" class="btn btn-link text-decoration-none btn-sm mt-1">去下一单采购?</a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<div th:replace="~{common :: commonScripts}"></div>

<script>
  function confirmInbound(id) {
    if(!confirm("确定货物已清点无误，并正式加入库存吗？")) {
      return;
    }

    $.ajax({
      url: "/inbound/confirm/" + id,
      type: "POST",
      success: function(res) {
        if(res.success) {
          alert("入库成功！库存已更新。");
          location.reload();
        } else {
          alert("操作失败: " + res.msg);
        }
      },
      error: function() {
        alert("系统错误，请联系管理员");
      }
    });
  }
</script>

</body>
</html>