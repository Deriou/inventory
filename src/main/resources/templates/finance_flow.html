<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common :: commonHead('资金流水')}"></head>
<body>

<div>
    <nav th:replace="~{common :: sidebar('finance', 'finance_flow')}"></nav>

    <main>
        <div th:replace="~{common :: topbar}"></div>

        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-4 border-bottom pb-3">
            <div>
                <h1 class="h4 mb-1">资金收付流水</h1>
                <span class="text-muted small">查看系统的每一笔销售收入与采购支出记录</span>
            </div>
            <div class="d-flex gap-3">
                <span class="badge bg-success-subtle text-success border border-success-subtle px-3 py-2 rounded-pill">
                    <i class="bi bi-arrow-up-circle me-1"></i> 收入笔数: <span th:text="${#lists.size(sales)}">0</span>
                </span>
                <span class="badge bg-danger-subtle text-danger border border-danger-subtle px-3 py-2 rounded-pill">
                    <i class="bi bi-arrow-down-circle me-1"></i> 支出笔数: <span th:text="${#lists.size(inbounds)}">0</span>
                </span>
            </div>
        </div>

        <div class="card card-erp">
            <div class="card-header bg-white border-bottom-0 pt-3 pb-0">
                <ul class="nav nav-tabs card-header-tabs" id="financeTabs" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active fw-bold" data-bs-toggle="tab" data-bs-target="#income" type="button">
                            <i class="bi bi-wallet2 text-success me-1"></i> 销售收入
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link fw-bold" data-bs-toggle="tab" data-bs-target="#expense" type="button">
                            <i class="bi bi-credit-card text-danger me-1"></i> 采购支出
                        </button>
                    </li>
                </ul>
            </div>

            <div class="card-body p-0">
                <div class="tab-content">

                    <div class="tab-pane fade show active" id="income">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light text-muted">
                                <tr>
                                    <th class="ps-4">流水号</th>
                                    <th>类型</th>
                                    <th>金额</th>
                                    <th>时间</th>
                                    <th class="text-end pe-4">操作人</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="s : ${sales}">
                                    <td class="ps-4 font-monospace text-muted small" th:text="|INC-${s.id}|"></td>
                                    <td>
                                        <span class="badge bg-success text-white rounded-pill">销售收款</span>
                                    </td>
                                    <td class="text-success fw-bold">
                                        + ¥ <span th:text="${s.totalAmount}"></span>
                                    </td>
                                    <td class="text-muted small" th:text="${#temporals.format(s.saleTime, 'yyyy-MM-dd HH:mm')}"></td>
                                    <td class="text-end pe-4">
                                        <div class="d-flex align-items-center justify-content-end">
                                            <div class="bg-light rounded-circle text-center me-2" style="width:24px;height:24px;line-height:24px;">
                                                <i class="bi bi-person-fill text-secondary small"></i>
                                            </div>
                                            <span class="small">管理员</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(sales)}">
                                    <td colspan="5" class="text-center py-5 text-muted">暂无收入记录</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="expense">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light text-muted">
                                <tr>
                                    <th class="ps-4">流水号</th>
                                    <th>类型</th>
                                    <th>金额</th>
                                    <th>时间</th>
                                    <th class="text-end pe-4">状态</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="i : ${inbounds}" th:if="${i.status == 1}">
                                    <td class="ps-4 font-monospace text-muted small" th:text="|EXP-${i.id}|"></td>
                                    <td>
                                        <span class="badge bg-danger text-white rounded-pill">采购付款</span>
                                    </td>
                                    <td class="text-danger fw-bold">
                                        - ¥ <span th:text="${i.quantity * i.purchasePrice}"></span>
                                    </td>
                                    <td class="text-muted small" th:text="${#temporals.format(i.createTime, 'yyyy-MM-dd HH:mm')}"></td>
                                    <td class="text-end pe-4">
                                        <span class="badge bg-light text-secondary border">已结算</span>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(inbounds)}">
                                    <td colspan="5" class="text-center py-5 text-muted">暂无支出记录</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>
</div>

<div th:replace="~{common :: commonScripts}"></div>

</body>
</html>